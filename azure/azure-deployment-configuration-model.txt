#!/bin/bash  
#
# Bash script to configure the deployment of Web Framework Benchmarks on Windows Azure.
#
# This is a model file.
#
# Instructions:
# - Copy this file to a new file named "azure-deployment-configuration.sh" on the same directory.
# - Configure as documented below.
#
set -o igncr  # for Cygwin on Windows
export SHELLOPTS

#*****************************************************************************
# START OF CONFIGURATION
#*****************************************************************************

# Full pathname of the Windows Azure account publish settings file.
# This file can be downloaded with the "azure account download" command.
# For more information refer to http://www.windowsazure.com/en-us/manage/linux/other-resources/command-line-tools/
export AZURE_DEPLOYMENT_PUBLISHSETTINGS_LOCATION=""

# Name of the Windows Azure subscription where the resources will be created.
# Most Windows Azure accounts have a single subscription, but they can have many.
# To list the available subscriptions use the command "azure account import publishsettingsfile.publishsettings"
# where "publishsettingsfile.publishsettings" is the publish settings file downloaded previously.
export AZURE_DEPLOYMENT_SUBSCRIPTION=""

# Region where the resources will be created.
# To see a list of locations available for your subscription, execute the command "azure vm location list".
# Some choices may be "East US", "West US", "North Europe", "West Europe", "East Asia", "Southeast Asia".
export AZURE_DEPLOYMENT_LOCATION="East US"

# Name of the deployment on Windows Azure.
# It will be used as a prefix to name resources such as virtual machines.
# It has to be globally unique within Windows Azure and it can be at most 12 characters long.
# Suggestion: use the form "wfbMMDDHHmm" where:
#    wfb stands for "Web Framework Benchmarks"
#    MM is the current month with 2 digits
#    DD is the current day with 2 digits
#    HH is the hour part of the current time with 2 digits
#    MM is the minutes part of the current time with 2 digits
#    For example, for a deployment created at 4:23 pm, Aug 9th 2013:
#    export AZURE_DEPLOYMENT_NAME="wfb08090423"
export AZURE_DEPLOYMENT_NAME=""

# Size of the virtual machines to be created.
# Valid values include: extrasmall, small, medium, large, extralarge, a6, a7.
export AZURE_DEPLOYMENT_VM_SIZE="large"

# Windows Azure command line program.
# On Windows: export AZURE_COMMAND="cywgin_cmd azure.cmd"
# On Linux/Mac: export AZURE_COMMAND="azure"
export AZURE_COMMAND="cywgin_cmd azure.cmd"

#*****************************************************************************
# STOP HERE - END OF CONFIGURATION
#*****************************************************************************

# What follows below are common definitions shared by the scripts, which 
# are not supposed to require configuration.

# Function used to invoke Windows batch files.
# It removes cygwinisms from the PATH and the environment first
# and does some argument pre-processing.
# It also seems to fix the space problem.
# Author: Igor Pechtchanski
# http://cygwin.com/ml/cygwin/2004-09/msg00150.html
cywgin_cmd () 
{ 
    ( local c="`cygpath -w \"$1\"`";
    shift;
    local cmd=`cygpath -u $COMSPEC`;
    while [ $# != 0 ]; do
        if [ -f "$1" ]; then
            local args="$args '`cygpath -w $1`'";
        else
            if [ -d "$1" ]; then
                local args="$args '`cygpath -w $1 | sed 's@\\\\\$@@'`'";
            else
                local args="$args '$1'";
            fi;
        fi;
        shift;
    done;
    PATH=`echo $PATH |
          tr : '\n' |
          egrep -vw '^(/usr/local/bin|/usr/bin|/bin|/usr/X11R6/bin)$' |
          tr '\n' :`;
    unset BASH_ENV COLORTERM CYGWIN DISPLAY HISTCONTROL MAKE_MODE;
    unset MANPATH PKG_CONFIG_PATH PS1 PWD SHLVL TERM USER _;
    unset CVS CVSROOT CVS_RSH GEN_HOME GROOVY_HOME TOMCAT_DIR;
    eval $cmd /c "$c" $args ) # TODO: seems to be losing return code; scripts don't abort when they should.
}
